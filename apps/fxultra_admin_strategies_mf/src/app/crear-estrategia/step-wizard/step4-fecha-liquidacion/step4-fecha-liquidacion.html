<!-- apps/fxultra_admin_strategies_mf/src/app/crear-estrategia/step-wizard/step4-fecha-liquidacion/step4-fecha-liquidacion.html -->

<!-- ─────────────────────────────────────────────────────────────────────────────
     Sección: Contenedor y título
     ───────────────────────────────────────────────────────────────────────────── -->
<div class="fecha-liquidacion-container">
  <div class="titulo">
    Selecciona por moneda previamente seleccionada la fecha de liquidación para las operaciones
  </div>

  <!-- ─────────────────────────────────────────────────────────────────────────────
       Sección: Selección masiva
       ───────────────────────────────────────────────────────────────────────────── -->
  <label class="check-todos">
    <input
      type="checkbox"
      class="custom-checkbox"
      [checked]="masivo.activo"
      (change)="abrirModalMasivo($event)"
    />
    <span class="checkbox-custom"></span>
    <span class="check-todos-label">
      Mismas fechas de liquidación todos los pares de divisas (excepto Yen japonés)
    </span>
  </label>

  <!-- ─────────────────────────────────────────────────────────────────────────────
       Sección: Tabla
       ───────────────────────────────────────────────────────────────────────────── -->
  <div class="tabla-wrapper">
    <table class="tabla-fecha" role="table">
      <colgroup>
        <col class="col-check" />
        <col class="col-par" />
        <col class="col-fecha" />
      </colgroup>

      <thead>
        <tr>
          <th></th>
          <th>Pares de divisas</th>
          <th>Fecha liquidación</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let row of filas">
          <td>
            <label class="par-checkbox par-checkbox--tabla">
              <input
                type="checkbox"
                class="custom-checkbox"
                [(ngModel)]="row._selected"
                (ngModelChange)="guardarEnStorage()"
              />
              <span class="checkbox-custom"></span>
            </label>
          </td>

          <td>{{ row.parNombre }}</td>

          <td>
            <div class="fecha-box" [class.error]="showAlertaSinSeleccion && row.seleccion.length === 0">
              <div class="select-sim" [class.open]="row._open">
                <button
                  type="button"
                  class="select-btn"
                  (click)="$event.stopPropagation(); toggleMenu(row)">
                  <span class="select-label">{{ resumenSeleccion(row) || 'Selecciona' }}</span>
                  <span class="caret"></span>
                </button>

                <div class="menu" *ngIf="row._open" (click)="$event.stopPropagation()">
                  <button
                    type="button"
                    class="menu-item"
                    [class.active]="tieneTodas(row)"
                    (click)="$event.stopPropagation(); toggleOpcion(row,'all')">
                    <span class="mini-checkbox" aria-hidden="true"></span>
                    <span>Todas las fechas</span>
                  </button>

                  <ng-container *ngIf="!row.esJPY; else opcionesJPY">
                    <button type="button" class="menu-item" [class.active]="isSeleccionado(row,'today')" (click)="$event.stopPropagation(); toggleOpcion(row,'today')">
                      <span class="mini-checkbox" aria-hidden="true"></span><span>Today</span>
                    </button>
                    <button type="button" class="menu-item" [class.active]="isSeleccionado(row,'tom')" (click)="$event.stopPropagation(); toggleOpcion(row,'tom')">
                      <span class="mini-checkbox" aria-hidden="true"></span><span>TOM</span>
                    </button>
                    <button type="button" class="menu-item" [class.active]="isSeleccionado(row,'spot48')" (click)="$event.stopPropagation(); toggleOpcion(row,'spot48')">
                      <span class="mini-checkbox" aria-hidden="true"></span><span>SPOT (48h)</span>
                    </button>
                    <button type="button" class="menu-item" [class.active]="isSeleccionado(row,'1d72')" (click)="$event.stopPropagation(); toggleOpcion(row,'1d72')">
                      <span class="mini-checkbox" aria-hidden="true"></span><span>1D (72h)</span>
                    </button>
                    <button type="button" class="menu-item disabled">
                      <span class="mini-checkbox" aria-hidden="true"></span><span>2D (96h)</span>
                    </button>
                  </ng-container>

                  <ng-template #opcionesJPY>
                    <button type="button" class="menu-item" [class.active]="isSeleccionado(row,'spot48')" (click)="$event.stopPropagation(); toggleOpcion(row,'spot48')">
                      <span class="mini-checkbox" aria-hidden="true"></span><span>SPOT (48h)</span>
                    </button>
                    <button type="button" class="menu-item" [class.active]="isSeleccionado(row,'1d72')" (click)="$event.stopPropagation(); toggleOpcion(row,'1d72')">
                      <span class="mini-checkbox" aria-hidden="true"></span><span>1D (72h)</span>
                    </button>
                  </ng-template>
                </div>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ─────────────────────────────────────────────────────────────────────────────
       Sección: Mensajes
       ───────────────────────────────────────────────────────────────────────────── -->
  <div class="alerta-wrapper">
    <div *ngIf="showAlertaSinSeleccion" class="mensaje-error">
      <i class="fas fa-exclamation-circle"></i>
      <span class="strong">Selecciona la(s) fecha(s) de liquidación para cada una de las divisas</span>
    </div>
  </div>

  <!-- ─────────────────────────────────────────────────────────────────────────────
       Sección: Acciones
       ───────────────────────────────────────────────────────────────────────────── -->
  <div class="acciones">
    <button class="btn-principal" (click)="aplicarConfiguracion()">Aplicar configuración</button>
    <span class="restablecer" (click)="restablecer()">Reestablecer</span>
  </div>

  <div class="progreso">Paso 4 de 7</div>
</div>

<!-- ─────────────────────────────────────────────────────────────────────────────
     Sección: Modal masivo
     ───────────────────────────────────────────────────────────────────────────── -->
<div class="modal-backdrop" *ngIf="mostrarModalMasivo" (click)="cerrarModalMasivo(false)"></div>
<div
  class="modal-contenedor"
  *ngIf="mostrarModalMasivo"
  role="dialog"
  aria-modal="true"
  aria-label="Fechas de liquidación"
  tabindex="0"
  (click)="$event.stopPropagation()"
  style="width: 326px;"
>
  <button
    class="modal-cerrar"
    type="button"
    (click)="onCloseClick($event)"
    aria-label="Cerrar"
    title="Cerrar"
  >
    <svg class="modal-cerrar__icon" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M18 6L6 18M6 6l12 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>

  <div class="modal-body">
    <div class="modal-titulo">Fechas de liquidación</div>

    <p class="modal-desc">Aplicar a todas las monedas (excepto JPY)</p>
    <div class="modal-list" (click)="$event.stopPropagation()">
      <button type="button" class="item" [class.active]="isGenAll()" (click)="$event.stopPropagation(); toggleGen('all')">
        <span class="mini-checkbox"></span><span>Todas las fechas</span>
      </button>
      <button type="button" class="item" [class.active]="isGenSel('today')" (click)="$event.stopPropagation(); toggleGen('today')">
        <span class="mini-checkbox"></span><span>Today</span>
      </button>
      <button type="button" class="item" [class.active]="isGenSel('tom')" (click)="$event.stopPropagation(); toggleGen('tom')">
        <span class="mini-checkbox"></span><span>TOM</span>
      </button>
      <button type="button" class="item" [class.active]="isGenSel('spot48')" (click)="$event.stopPropagation(); toggleGen('spot48')">
        <span class="mini-checkbox"></span><span>SPOT (48h)</span>
      </button>
      <button type="button" class="item" [class.active]="isGenSel('1d72')" (click)="$event.stopPropagation(); toggleGen('1d72')">
        <span class="mini-checkbox"></span><span>1D (72h)</span>
      </button>
      <button type="button" class="item disabled">
        <span class="mini-checkbox"></span><span>2D (96h)</span>
      </button>
    </div>

    <div class="switch-jpy">
      <span class="switch-jpy-label">Aplicar también a JPY</span>
      <label class="switch">
        <input type="checkbox" [(ngModel)]="modalJPYEnabled" [disabled]="!tieneJPY" />
        <span class="slider"></span>
      </label>
    </div>

    <div class="modal-list" *ngIf="tieneJPY && modalJPYEnabled" (click)="$event.stopPropagation()">
      <button type="button" class="item" [class.active]="isJpyAll()" (click)="$event.stopPropagation(); toggleJpy('all')">
        <span class="mini-checkbox"></span><span>Todas las fechas</span>
      </button>
      <button type="button" class="item" [class.active]="isJpySel('spot48')" (click)="$event.stopPropagation(); toggleJpy('spot48')">
        <span class="mini-checkbox"></span><span>SPOT (48h)</span>
      </button>
      <button type="button" class="item" [class.active]="isJpySel('1d72')" (click)="$event.stopPropagation(); toggleJpy('1d72')">
        <span class="mini-checkbox"></span><span>1D (72h)</span>
      </button>
    </div>

    <div class="modal-footer">
      <button class="btn-principal btn-modal" (click)="aplicarModalMasivo()">Aplicar fechas</button>
    </div>
  </div>
</div>

<!-- ─────────────────────────────────────────────────────────────────────────────
     Sección: Modal OK
     ───────────────────────────────────────────────────────────────────────────── -->
<div class="modal-backdrop" *ngIf="mostrarModalOk" (click)="$event.stopPropagation(); cerrarModalOk()"></div>
<div
  class="modal-contenedor modal-ok-peq"
  *ngIf="mostrarModalOk"
  role="dialog"
  aria-modal="true"
  aria-label="Datos actualizados"
  (click)="$event.stopPropagation()"
>
  <button
    class="modal-cerrar"
    type="button"
    (click)="cerrarModalOk(); $event.stopPropagation()"
    aria-label="Cerrar"
    title="Cerrar"
  >
    <svg class="modal-cerrar__icon" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M18 6L6 18M6 6l12 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  </button>

  <div class="modal-body modal-ok__body-peq">
    <div class="modal-titulo modal-ok__titulo-peq">Datos actualizados exitosamente</div>
    <div class="modal-footer">
      <button class="btn-principal btn-modal btn-modal--peq" (click)="cerrarModalOk()">Aceptar</button>
    </div>
  </div>
</div>
